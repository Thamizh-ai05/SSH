<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Student Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8fafc;
        }

        /* Navigation */
        .navbar {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            color: white;
            padding: 1rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-menu-wrapper {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn-auth {
            padding: 0.5rem 1rem;
            border: 1px solid white;
            background: transparent;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-auth:hover {
            background: white;
            color: #2563eb;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mobile-menu {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Auth Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #6b7280;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
        }

        .user-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .user-type {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-type.selected {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #2563eb, #1e40af, #3b82f6);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: white;
            color: #2563eb;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: #2563eb;
        }

        /* About Section */
        .about-section {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .about-section h2 {
            color: #1e40af;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .about-section p {
            max-width: 800px;
            margin: 0 auto;
            color: #6b7280;
            text-align: left;
        }
        
        .about-section p ul li {
            list-style: none;
            padding-left: 1rem;
            text-indent: -1rem;
        }


        /* Dashboard & Profile Section */
        .dashboard, .profile-section {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard h2, .profile-section h2 {
            color: #1e40af;
            margin-bottom: 2rem;
            font-size: 2.5rem;
            text-align: center;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.3rem;
            color: #1e40af;
            font-weight: 600;
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #059669;
            margin: 1rem 0;
        }

        .card-description {
            color: #6b7280;
        }
        
        /* Profile specific styles */
        .profile-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        .profile-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #1e40af;
        }

        .profile-card p {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .list-container {
            margin-top: 2rem;
        }
        
        .list-container h3 {
            font-size: 1.5rem;
            color: #1e40af;
            margin-bottom: 1rem;
        }
        
        .list-group {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }
        
        .list-item {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        /* Activity Tracker */
        .activity-tracker {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .activity-form {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .faculty-search {
            position: relative;
            margin-bottom: 1rem;
        }

        .faculty-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .faculty-option {
            padding: 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.3s ease;
        }

        .faculty-option:hover {
            background: #f3f4f6;
        }

        .pending-approvals {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        .approval-item {
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #fef3c7;
            border-radius: 0 10px 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .approval-item.approved {
            border-left-color: #10b981;
            background: #d1fae5;
        }

        .approval-item.rejected {
            border-left-color: #ef4444;
            background: #fee2e2;
        }

        .approval-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-approve {
            background: #10b981;
            color: white;
        }

        .btn-reject {
            background: #ef4444;
            color: white;
        }

        /* Faculty Dashboard */
        .faculty-dashboard {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .approval-queue {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        /* Recommendations */
        .recommendations {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .recommendation-category {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        .recommendation-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            border-color: #3b82f6;
            transform: translateX(5px);
        }
        
        .recommendation-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .recommendation-meta .btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        /* Chatbot */
        .chatbot-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .chatbot-button:hover {
            transform: scale(1.1);
        }

        .chatbot-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            display: none;
            flex-direction: column;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 1rem;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 10px;
            animation: fadeIn 0.3s ease;
        }

        .message.bot {
            background: #f3f4f6;
            align-self: flex-start;
        }

        .message.user {
            background: #3b82f6;
            color: white;
            align-self: flex-end;
            margin-left: auto;
            max-width: 80%;
        }

        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
        }

        .chatbot-input input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #e5e7eb;
            border-radius: 25px;
            outline: none;
        }

        .chatbot-input button {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }

        /* Real-time updates */
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Footer */
        .footer {
            background: #1f2937;
            color: white;
            padding: 3rem 2rem 1rem;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: #3b82f6;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .social-icon:hover {
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: #1e40af;
                flex-direction: column;
                padding: 1rem;
                display: none;
            }
            
            .nav-menu-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 0;
            }
            
            .nav-menu-wrapper .user-info {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .nav-menu-wrapper .user-info button {
                width: 100%;
            }

            .nav-menu.active {
                display: flex;
            }
            
            .auth-buttons {
                width: 100%;
            }

            .mobile-menu {
                display: block;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .chatbot-window {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Loading spinner */
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .printable-content, .printable-content * {
                visibility: visible;
            }
            .printable-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }

        .dashboard-card .details {
            border-top: 1px solid #e5e7eb;
            margin-top: 1rem;
            padding-top: 1rem;
        }
        
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                📚 Smart Student Hub
            </div>
            <div class="nav-menu-wrapper">
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="home">Home</a></li>
                    <li id="dashboard-nav-link" class="hidden"><a href="#" class="nav-link" data-section="dashboard">Dashboard</a></li>
                    <li id="activity-nav-link" class="hidden"><a href="#" class="nav-link" data-section="activities">Activities</a></li>
                    <li id="recommendations-nav-link" class="hidden"><a href="#" class="nav-link" data-section="recommendations">Recommendations</a></li>
                    <li id="faculty-reg-nav-link" class="hidden"><a href="#" class="nav-link" data-section="faculty-registration">New Faculty</a></li>
                    <li id="student-reg-nav-link" class="hidden"><a href="#" class="nav-link" data-section="student-registration">New Student</a></li>
                    <li id="student-search-nav-link" class="hidden"><a href="#" class="nav-link" data-section="student-search">Student Search</a></li>
                </ul>
                <div class="auth-buttons" id="authButtons">
                    <button class="btn-auth" onclick="openModal('login')">Login</button>
                </div>
                <div class="user-info hidden" id="userInfo">
                    <span class="live-indicator"></span>
                    <span id="userWelcome"></span>
                    <button class="btn-auth" onclick="logout()">Logout</button>
                </div>
            </div>
            <button class="mobile-menu">☰</button>
        </div>
    </nav>

    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="auth-tabs">
                <button class="auth-tab active">Login</button>
            </div>

            <div class="user-type-selector" id="userTypeSelector">
                <div class="user-type" data-type="admin">
                    <div style="font-size: 2rem;">🏢</div>
                    <div>College Admin</div>
                </div>
                <div class="user-type selected" data-type="student">
                    <div style="font-size: 2rem;">👨‍🎓</div>
                    <div>Student</div>
                </div>
                <div class="user-type" data-type="faculty">
                    <div style="font-size: 2rem;">👨‍🏫</div>
                    <div>Faculty</div>
                </div>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label>Email/ID</label>
                    <input type="text" id="loginId" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>

            <button onclick="closeModal()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
        </div>
    </div>

    <main class="main-content">
        <section id="home" class="section active">
            <div class="hero" id="hero-section">
                <div class="hero-content">
                    <h1>Smart Student Hub</h1>
                    <p>A Centralised Digital Platform for Student Achievements</p>
                    <div class="hero-buttons">
                        <button class="btn btn-primary" onclick="openModal()">Login</button>
                        <button class="btn btn-secondary">Learn More</button>
                    </div>
                </div>
            </div>
            <div id="about-section" class="about-section">
                <h2>About Us</h2>
                <p>
                    Smart Student Hub is a centralized digital platform designed to capture and showcase the complete journey of students in higher education. It brings together academic achievements, extracurricular activities, certifications, internships, and community contributions into one verified profile, ensuring nothing is scattered or lost. The platform empowers students with a dynamic digital portfolio that supports career planning, placements, and higher studies applications, while also enabling faculty to mentor effectively through real-time data. At the institutional level, it simplifies reporting and reduces administrative burden during audits and accreditations. With features like faculty approval systems, AI-powered recommendations for internships and scholarships, and an integrated chatbot for career guidance, Smart Student Hub modernizes student activity management and aligns with the digital transformation goals of higher education institutions.
                </p>
            </div>
            <div id="profile-content" class="profile-section hidden"></div>
        </section>

        <section id="dashboard" class="section">
            <div class="dashboard">
                <h2 id="dashboardTitle">Dashboard</h2>
                <div id="dashboardContent">
                    </div>
            </div>
        </section>

        <section id="activities" class="section">
            <div class="activity-tracker">
                <h2 style="color: #1e40af; margin-bottom: 2rem; font-size: 2.5rem; text-align: center;">Activity Tracker</h2>
                
                <div class="activity-form" id="studentActivityForm">
                    <h3 style="margin-bottom: 1.5rem; color: #374151;">Submit New Activity</h3>
                    <form id="activitySubmissionForm">
                        <div class="form-group">
                            <label>Activity Type</label>
                            <select id="activityType" required>
                                <option value="">Select Activity Type</option>
                                <option value="workshop">Workshop</option>
                                <option value="competition">Competition</option>
                                <option value="internship">Internship</option>
                                <option value="certification">Certification</option>
                                <option value="volunteer">Volunteer Work</option>
                                <option value="research">Research Project</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Event/Activity Name</label>
                            <input type="text" id="activityName" required>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea rows="4" id="activityDescription" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Faculty Supervisor</label>
                            <div class="faculty-search">
                                <input type="text" id="facultySearch" placeholder="Search faculty by name or ID..." required>
                                <div class="faculty-dropdown" id="facultyDropdown"></div>
                            </div>
                            <input type="hidden" id="selectedFacultyId">
                        </div>
                        <div class="form-group">
                            <label>Certificate/Proof (PDF/Image)</label>
                            <input type="file" id="activityFile" accept=".pdf,.jpg,.jpeg,.png" required>
                        </div>
                        <div class="form-group">
                            <label>Date of Activity</label>
                            <input type="date" id="activityDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit for Approval</button>
                    </form>
                </div>

                <div class="faculty-dashboard hidden" id="facultyApprovalPanel">
                    <h3 style="margin-bottom: 1.5rem; color: #374151;">Faculty Approval Panel</h3>
                    <div class="approval-queue" id="approvalQueue">
                        </div>
                </div>

                <div class="pending-approvals">
                    <h3 style="margin-bottom: 1.5rem; color: #374151;">
                        <span class="live-indicator"></span>
                        Activity Status (Live Updates)
                    </h3>
                    <div id="pendingApprovalsList">
                        </div>
                    <div id="approvedRejectedList" style="margin-top: 2rem;">
                         <h4 style="margin-bottom: 1rem;">Approved/Rejected Activities</h4>
                         <div id="approvedRejectedItems"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="recommendations" class="section">
            <div class="recommendations">
                <h2 style="color: #1e40af; margin-bottom: 2rem; font-size: 2.5rem; text-align: center;">
                    <span class="live-indicator"></span>
                    Personalized Recommendations
                </h2>
                
                <div class="recommendations-grid">
                    <div class="recommendation-category">
                        <h3 style="color: #059669; margin-bottom: 1rem;">🚀 Internships</h3>
                        <div id="internship-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <div class="recommendation-category">
                        <h3 style="color: #7c3aed; margin-bottom: 1rem;">🎓 Scholarships</h3>
                        <div id="scholarship-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <div class="recommendation-category">
                        <h3 style="color: #dc2626; margin-bottom: 1rem;">💼 Jobs</h3>
                        <div id="job-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <div class="recommendation-category">
                        <h3 style="color: #ea580c; margin-bottom: 1rem;">📅 Events</h3>
                        <div id="event-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="faculty-registration" class="section">
            <div class="dashboard">
                <h2 style="color: #1e40af; margin-bottom: 2rem; text-align: center;">New Faculty Registration</h2>
                <div class="activity-form">
                    <form id="facultyRegistrationForm">
                         <div class="form-group">
                            <label>Faculty ID</label>
                            <input type="text" id="regFacultyId" required>
                        </div>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="regFacultyName" required>
                        </div>
                         <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="regFacultyEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <select id="regFacultyDepartment">
                                <option value="Artificial Intelligence & Data Science">Artificial Intelligence & Data Science</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Civil">Civil</option>
                                <option value="Chemical">Chemical</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label>Designation</label>
                            <input type="text" id="regFacultyDesignation" required>
                        </div>
                         <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="regFacultyPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Register Faculty</button>
                    </form>
                </div>
            </div>
        </section>

        <section id="student-registration" class="section">
            <div class="dashboard">
                <h2 style="color: #1e40af; margin-bottom: 2rem; text-align: center;">New Student Registration</h2>
                <div class="activity-form">
                    <form id="studentRegistrationForm">
                         <div class="form-group">
                            <label>Student ID</label>
                            <input type="text" id="regStudentId" required>
                        </div>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="regStudentName" required>
                        </div>
                         <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="regStudentEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Branch</label>
                            <select id="regStudentBranch" required>
                                <option value="Artificial Intelligence & Data Science">Artificial Intelligence & Data Science</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Civil">Civil</option>
                                <option value="Chemical">Chemical</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label>Year</label>
                            <input type="text" id="regStudentYear" required>
                        </div>
                        <div class="form-group">
                            <label>CGPA</label>
                            <input type="number" step="0.1" id="regStudentCgpa" required>
                        </div>
                         <div class="form-group">
                            <label>Attendance (%)</label>
                            <input type="number" step="1" id="regStudentAttendance" required>
                        </div>
                         <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="regStudentPassword" required>
                        </div>
                        <div class="form-group">
                            <label>Faculty Supervisor</label>
                             <select id="regStudentSupervisor" required>
                                <option value="">Select Supervisor</option>
                             </select>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Register Student</button>
                    </form>
                </div>
            </div>
        </section>

        <section id="student-search" class="section">
            <div class="dashboard">
                <h2 style="color: #1e40af; margin-bottom: 2rem; text-align: center;">Student Profile Search</h2>
                 <div class="activity-form">
                    <div class="form-group">
                        <label>Search by Student ID or Name</label>
                        <input type="text" id="studentSearchInput" placeholder="e.g., VH13000 or Shyam Sundar">
                    </div>
                    <button class="btn btn-primary" onclick="searchStudent()">Search</button>
                </div>
                <div class="list-container" id="studentSearchResult">
                    <h3 style="color: #1e40af;">Search Results</h3>
                    <div class="list-group" id="studentSearchItems">
                        <p>Search for a student to see their profile.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <button class="chatbot-button" onclick="toggleChat()">💬</button>
    <div class="chatbot-window" id="chatWindow">
        <div class="chatbot-header">
            <span>Smart Assistant</span>
            <button onclick="toggleChat()" style="background: none; border: none; color: white; cursor: pointer;">×</button>
        </div>
        <div class="chatbot-messages" id="chatMessages">
            <div class="message bot">
                Hi! I'm your Smart Student Hub assistant. How can I help you today?
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatInput" placeholder="Type your message..." onkeypress="handleChatEnter(event)">
            <button onclick="sendMessage()">📤</button>
        </div>
    </div>
     <div id="studentProfileModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div id="studentProfileDetails"></div>
            <button onclick="closeStudentProfileModal()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
        </div>
    </div>


    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Info</h3>
                <p>📧 smartstudenthub@ssh.com</p>
                <p>📞 +91 9876543210</p>
                <p>📍 India</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <p>About Us</p>
                <p>Privacy Policy</p>
                <p>Terms of Service</p>
                <p>Support</p>
            </div>
            <div class="footer-section">
                <h3>Features</h3>
                <p>Activity Tracking</p>
                <p>AI Recommendations</p>
                <p>Performance Analytics</p>
                <p>Certificate Management</p>
            </div>
        </div>
        <div class="social-icons">
            <a href="#" class="social-icon">📘</a>
            <a href="#" class="social-icon">🐦</a>
            <a href="#" class="social-icon">💼</a>
            <a href="#" class="social-icon">📷</a>
        </div>
        <p>&copy; 2025 Smart Student Hub. All rights reserved. | SIH Hackathon Project | Developed by Unstoppable Team</p>
    </footer>

    <script>
        // Global Variables
        let currentUser = null;
        let userType = null;
        let activities = [];
        let facultyList = [];
        let wsConnection = null;
        const GEMINI_API_KEY = "";
        const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`;

        // Mock Database
        let mockUsers = {
            students: [],
            faculty: [],
            admins: [
                {id: 'VH001', password: 'pass123', name: 'College Admin', college: 'Vel Tech High Tech'}
            ]
        };
        const departments = ['Artificial Intelligence & Data Science','Computer Science', 'Electronics', 'Mechanical', 'Civil', 'Chemical'];
        const registeredStudents = {};

        const mockActivities = [
            {
                id: 'ACT001', studentId: 'VH13005', type: 'certification', name: 'Google Cloud Certification',
                description: 'Completed Google Cloud Professional certification', facultyId: 'F002',
                status: 'pending', submittedAt: new Date('2025-09-15'), file: 'certificate.pdf'
            },
            {
                id: 'ACT002', studentId: 'VH13005', type: 'workshop', name: 'React.js Workshop',
                description: 'Attended 3-day React.js workshop', facultyId: 'F002',
                status: 'approved', submittedAt: new Date('2025-09-10'), approvedAt: new Date('2025-09-12'), file: 'workshop-certificate.pdf'
            },
            {
                id: 'ACT003', studentId: 'VH13000', type: 'competition', name: 'National Robotics Olympiad',
                description: 'Participated in the national robotics competition', facultyId: 'F001',
                status: 'pending', submittedAt: new Date('2025-09-20'), file: 'olympiad-certificate.pdf'
            },
            {
                id: 'ACT004', studentId: 'VH13000', type: 'research', name: 'AI in Healthcare Research Paper',
                description: 'Co-authored a research paper on AI in diagnostics.', facultyId: 'F001',
                status: 'approved', submittedAt: new Date('2025-08-01'), approvedAt: new Date('2025-08-05'), file: 'research-paper.pdf'
            },
          {
                id: 'ACT005', studentId: 'VH12909', type: 'certification', name: 'Google Cloud Certification',
                description: 'Completed Google Cloud Professional certification', facultyId: 'F003',
                status: 'pending', submittedAt: new Date('2025-09-15'), file: 'certificate.pdf'
            },
            {
                id: 'ACT006', studentId: 'VH12909', type: 'workshop', name: 'React.js Workshop',
                description: 'Attended 3-day React.js workshop', facultyId: 'F003',
                status: 'approved', submittedAt: new Date('2025-09-10'), approvedAt: new Date('2025-09-12'), file: 'workshop-certificate.pdf'
            },
            {
                id: 'ACT007', studentId: 'VH13018', type: 'competition', name: 'National Robotics Olympiad',
                description: 'Participated in the national robotics competition', facultyId: 'F002',
                status: 'pending', submittedAt: new Date('2025-09-20'), file: 'olympiad-certificate.pdf'
            },
            {
                id: 'ACT008', studentId: 'VH13018', type: 'research', name: 'AI in Healthcare Research Paper',
                description: 'Co-authored a research paper on AI in diagnostics.', facultyId: 'F002',
                status: 'approved', submittedAt: new Date('2025-08-01'), approvedAt: new Date('2025-08-05'), file: 'research-paper.pdf'
            },
          {
                id: 'ACT009', studentId: 'VH13001', type: 'competition', name: 'National Robotics Olympiad',
                description: 'Participated in the national robotics competition', facultyId: 'F003',
                status: 'pending', submittedAt: new Date('2025-09-20'), file: 'olympiad-certificate.pdf'
            },
            {
                id: 'ACT0010', studentId: 'VH13001', type: 'research', name: 'AI in Healthcare Research Paper',
                description: 'Co-authored a research paper on AI in diagnostics.', facultyId: 'F003',
                status: 'approved', submittedAt: new Date('2025-08-01'), approvedAt: new Date('2025-08-05'), file: 'research-paper.pdf'
            },
          {
                id: 'ACT011', studentId: 'VH12998', type: 'competition', name: 'National Robotics Olympiad',
                description: 'Participated in the national robotics competition', facultyId: 'F001',
                status: 'pending', submittedAt: new Date('2025-09-20'), file: 'olympiad-certificate.pdf'
            },
            {
                id: 'ACT012', studentId: 'VH12998', type: 'research', name: 'AI in Healthcare Research Paper',
                description: 'Co-authored a research paper on AI in diagnostics.', facultyId: 'F001',
                status: 'approved', submittedAt: new Date('2025-08-01'), approvedAt: new Date('2025-08-05'), file: 'research-paper.pdf'
            },
            {
                id: 'ACT013', studentId: 'VH13005', type: 'internship', name: 'Summer Internship at Google',
                description: 'Completed a 10-week summer internship in software development.', facultyId: 'F002',
                status: 'approved', submittedAt: new Date('2025-07-01'), approvedAt: new Date('2025-07-05'), file: 'internship-certificate.pdf'
            },
            {
                id: 'ACT014', studentId: 'VH13005', type: 'internship', name: 'AI Intern at IBM',
                description: '6-week internship in AI development.', facultyId: 'F002',
                status: 'rejected', submittedAt: new Date('2025-06-20'), rejectedAt: new Date('2025-06-25'), file: 'internship-proposal.pdf'
            }
        ];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            loadMockData();
            initializeApp();
            setupEventListeners();
            setupRealTimeUpdates();
        });

        function loadMockData() {
            // Mock Admin Panel creating faculty accounts
            mockUsers.faculty = [
                { id: 'F001', name: 'Dr. M. Balaji', email: 'balaji.m@velhightech.com', password: 'pass123', department: 'Artificial Intelligence & Data Science', designation: 'Professor' },
                { id: 'F002', name: 'Dr. B. Tamilselvi', email: 'tamilselvi.b@velhightech.com', password: 'pass123', department: 'Artificial Intelligence & Data Science', designation: 'Professor' },
              { id: 'F003', name: 'Dr. Priya', email: 'priya.rv@velhightech.com', password: 'pass123', department: 'Artificial Intelligence & Data Science', designation: 'Professor' }
            ];
            
            mockUsers.admins = [
                 {id: 'VH001', password: 'pass123', name: 'College Admin', college: 'Vel Tech High Tech'}
            ];

            // Mock Faculty creating student accounts
            mockUsers.students = [
                { id: 'VH13000', name: 'Shyam Sundar R', email: 'vh13000_ai23@velhightech.com', password: 'pass123', branch: 'Artificial Intelligence & Data Science', year: '3rd Year', cgpa: 8.8, attendance: 92, skills: ['Python', 'Java', 'Web Development'], interests: ['AI/ML', 'Software Development'], registeredByFacultyId: 'F001' },
                { id: 'VH12909', name: 'Ashtami R S', email: 'vh12909_ai23@velhightech.com', password: 'pass123', branch: 'Artificial Intelligence & Data Science', year: '3rd Year', cgpa: 8.8, attendance: 92, skills: ['C++', 'Algorithms'], interests: ['Competitive Programming'], registeredByFacultyId: 'F003' },
               { id: 'VH12998', name: 'Shree Hari S L', email: 'vh12998_ai23@velhightech.com', password: 'pass123', branch: 'Artificial Intelligence & Data Science', year: '3rd Year', cgpa: 8.0, attendance: 90, skills: ['Python', 'Java', 'Web Development'], interests: ['AI/ML', 'Software Development'], registeredByFacultyId: 'F001' },
                { id: 'VH13018', name: 'Yasvanthini T', email: 'vh13018_ai23@velhightech.com', password: 'pass123', branch: 'Artificial Intelligence & Data Science', year: '3rd Year', cgpa: 8.2, attendance: 93, skills: ['C++', 'Algorithms'], interests: ['Competitive Programming'], registeredByFacultyId: 'F002' },
              { id: 'VH13001', name: 'Sowmiya S', email: 'vh13001_ai23@velhightech.com', password: 'pass123', branch: 'Artificial Intelligence & Data Science', year: '3rd Year', cgpa: 8.2, attendance: 91, skills: ['Python', 'Java', 'Web Development'], interests: ['AI/ML', 'Software Development'], registeredByFacultyId: 'F003' },
                { id: 'VH13005', name: 'Thamizharasan K', email: 'vh3005_ai23@velhightech.com', password: 'pass123', branch: 'Artificial Intelligence & Data Science', year: '3rd Year', cgpa: 7.5, attendance: 85, skills: ['JAVA','GitHub', 'Algorithms'], interests: ['Competitive Programming','System Design'], registeredByFacultyId: 'F002' }
            ];

            facultyList = mockUsers.faculty;
            activities = [...mockActivities];
        }

        function initializeApp() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                userType = localStorage.getItem('userType');
                updateUIForLoggedInUser();
            } else {
                showInitialHomePage();
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    showSection(section);
                });
            });

            document.querySelector('.mobile-menu').addEventListener('click', () => {
                document.querySelector('.nav-menu-wrapper').classList.toggle('active');
            });

            document.querySelectorAll('.user-type').forEach(type => {
                type.addEventListener('click', () => {
                    document.querySelectorAll('.user-type').forEach(t => t.classList.remove('selected'));
                    type.classList.add('selected');
                });
            });

            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            document.getElementById('activitySubmissionForm').addEventListener('submit', handleActivitySubmission);
            
            document.getElementById('facultySearch').addEventListener('input', handleFacultySearch);
            
            document.body.addEventListener('click', (e) => {
                if (e.target.id === 'generatePortfolioBtn') {
                    generatePortfolio();
                } else if (e.target.classList.contains('view-profile-btn')) {
                    const studentId = e.target.dataset.studentId;
                    showStudentProfile(studentId);
                }
            });

            document.getElementById('studentRegistrationForm').addEventListener('submit', handleStudentRegistration);
            document.getElementById('facultyRegistrationForm').addEventListener('submit', handleFacultyRegistration);
            document.getElementById('studentSearchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchStudent();
                }
            });
            
            if(document.getElementById('regStudentBranch')) {
                document.getElementById('regStudentBranch').addEventListener('change', updateFacultySupervisorOptions);
            }
        }

        function showInitialHomePage() {
            document.getElementById('hero-section').classList.remove('hidden');
            document.getElementById('about-section').classList.remove('hidden');
            document.getElementById('profile-content').classList.add('hidden');
            document.getElementById('faculty-reg-nav-link').classList.add('hidden');
            document.getElementById('student-reg-nav-link').classList.add('hidden');
            document.getElementById('student-search-nav-link').classList.add('hidden');
            document.getElementById('recommendations-nav-link').classList.add('hidden');
            document.getElementById('dashboard-nav-link').classList.add('hidden');
            document.getElementById('activity-nav-link').classList.add('hidden');
            
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector('[data-section="home"]').classList.add('active');
        }

        // Authentication Functions
        function openModal() {
            document.getElementById('authModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const loginId = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;
            const selectedUserType = document.querySelector('.user-type.selected').dataset.type;
            
            let user = null;
            if (selectedUserType === 'student') {
                user = mockUsers.students.find(s => 
                    (s.email === loginId || s.id === loginId) && s.password === password
                );
            } else if (selectedUserType === 'faculty') {
                user = mockUsers.faculty.find(f => 
                    (f.email === loginId || f.id === loginId) && f.password === password
                );
            } else if (selectedUserType === 'admin') {
                 user = mockUsers.admins.find(a => 
                    (a.email === loginId || a.id === loginId) && a.password === password
                );
            }
            
            if (user) {
                currentUser = user;
                userType = selectedUserType;
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.setItem('userType', selectedUserType);
                
                updateUIForLoggedInUser();
                closeModal();
                showSection('home');
                showNotification('Login successful!', 'success');
            } else {
                showNotification('Invalid credentials!', 'error');
            }
        }

        function logout() {
            currentUser = null;
            userType = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userType');
            
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            
            showInitialHomePage();
            
            showNotification('Logged out successfully!', 'success');
        }

        function updateUIForLoggedInUser() {
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.name}`;
            
            document.getElementById('hero-section').classList.add('hidden');
            document.getElementById('about-section').classList.add('hidden');
            document.getElementById('profile-content').classList.remove('hidden');

            document.getElementById('dashboard-nav-link').classList.add('hidden');
            document.getElementById('activity-nav-link').classList.add('hidden');
            document.getElementById('student-reg-nav-link').classList.add('hidden');
            document.getElementById('faculty-reg-nav-link').classList.add('hidden');
            document.getElementById('student-search-nav-link').classList.add('hidden');
            document.getElementById('recommendations-nav-link').classList.add('hidden');
            
            if (userType === 'faculty') {
                document.getElementById('dashboard-nav-link').classList.remove('hidden');
                document.getElementById('activity-nav-link').classList.remove('hidden');
                document.getElementById('student-reg-nav-link').classList.remove('hidden');
            } else if (userType === 'student') {
                document.getElementById('dashboard-nav-link').classList.remove('hidden');
                document.getElementById('activity-nav-link').classList.remove('hidden');
                document.getElementById('student-search-nav-link').classList.remove('hidden');
                document.getElementById('recommendations-nav-link').classList.remove('hidden');
                loadRecommendations();
            } else if (userType === 'admin') {
                document.getElementById('dashboard-nav-link').classList.remove('hidden');
                document.getElementById('faculty-reg-nav-link').classList.remove('hidden');
                document.getElementById('student-reg-nav-link').classList.remove('hidden');
            }

            loadProfile();
            loadDashboard();
            loadActivities();
        }

        // Navigation Functions
        function showSection(sectionName) {
            if (!currentUser && sectionName !== 'home') {
                showNotification('Please login to access this section!', 'error');
                openModal();
                return;
            }
            
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            const activeLink = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeLink) activeLink.classList.add('active');
            
            if (sectionName === 'student-registration' && currentUser && userType === 'faculty') {
                updateFacultySupervisorOptions();
                document.getElementById('regStudentBranch').value = currentUser.department;
                document.getElementById('regStudentBranch').disabled = true;
            } else if (sectionName === 'student-registration' && currentUser && userType === 'admin') {
                updateFacultySupervisorOptions();
                document.getElementById('regStudentBranch').disabled = false;
            }
        }
        
        // Profile & Dashboard Functions
        function loadProfile() {
            const heroSection = document.getElementById('hero-section');
            const aboutSection = document.getElementById('about-section');
            const profileContent = document.getElementById('profile-content');
            
            heroSection.classList.add('hidden');
            aboutSection.classList.add('hidden');
            profileContent.classList.remove('hidden');

            if (userType === 'student') {
                const approvedActivities = activities.filter(a => a.studentId === currentUser.id && a.status === 'approved');
                
                profileContent.innerHTML = `
                    <div class="profile-card printable-content">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="profile-avatar">👨‍🎓</div>
                            <h3>${currentUser.name}</h3>
                            <p style="color: #6b7280;">Student</p>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Student ID:</strong> ${currentUser.id}</div>
                            <div><strong>Email:</strong> ${currentUser.email}</div>
                            <div><strong>Branch:</strong> ${currentUser.branch || 'N/A'}</div>
                            <div><strong>Year:</strong> ${currentUser.year || 'N/A'}</div>
                            <div><strong>CGPA:</strong> ${currentUser.cgpa || 'N/A'}</div>
                            <div><strong>Skills:</strong> ${currentUser.skills ? currentUser.skills.join(', ') : 'N/A'}</div>
                            <div><strong>Interests:</strong> ${currentUser.interests ? currentUser.interests.join(', ') : 'N/A'}</div>
                            <div><strong>Approved Activities:</strong> ${approvedActivities.length}</div>
                        </div>
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-primary" id="generatePortfolioBtn">Generate Portfolio</button>
                        </div>
                    </div>
                `;
            } else if (userType === 'faculty'){ // Faculty
                const totalStudents = mockUsers.students.filter(s => s.branch === currentUser.department).length;
                const totalApproved = activities.filter(a => a.facultyId === currentUser.id && a.status === 'approved').length;
                
                profileContent.innerHTML = `
                    <div class="profile-card">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="profile-avatar">👨‍🏫</div>
                            <h3>${currentUser.name}</h3>
                            <p style="color: #6b7280;">${currentUser.designation}</p>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Faculty ID:</strong> ${currentUser.id}</div>
                            <div><strong>Email:</strong> ${currentUser.email}</div>
                            <div><strong>Department:</strong> ${currentUser.department}</div>
                            <div><strong>Total Students Supervised:</strong> ${totalStudents}</div>
                            <div><strong>Total Activities Approved:</strong> ${totalApproved}</div>
                        </div>
                    </div>
                `;
            } else if (userType === 'admin') {
                profileContent.innerHTML = `
                    <div class="profile-card">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="profile-avatar">🏢</div>
                            <h3>${currentUser.name}</h3>
                            <p style="color: #6b7280;">College Admin</p>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Admin ID:</strong> ${currentUser.id}</div>
                            <div><strong>College:</strong> ${currentUser.college}</div>
                        </div>
                    </div>
                `;
            }
        }

        function loadDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            const dashboardTitle = document.getElementById('dashboardTitle');
            
            if (userType === 'faculty') {
                dashboardTitle.textContent = 'Faculty Dashboard';
                loadFacultyDashboard();
            } else if (userType === 'student') {
                dashboardTitle.textContent = 'Student Dashboard';
                loadStudentDashboard();
            } else if (userType === 'admin') {
                 dashboardTitle.textContent = 'College Admin Dashboard';
                 loadAdminDashboard();
            }
        }
        
        function loadAdminDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            
            const facultyCount = mockUsers.faculty.length;
            const studentCount = mockUsers.students.length;
            
            let departmentsHTML = '';
            departments.forEach(dept => {
                const studentsInDept = mockUsers.students.filter(s => s.branch === dept).length;
                const facultyInDept = mockUsers.faculty.filter(f => f.department === dept).length;
                if (studentsInDept > 0 || facultyInDept > 0) {
                     departmentsHTML += `
                         <div class="list-item">
                            <strong>${dept}</strong>
                            <br><small>Students: ${studentsInDept}, Faculty: ${facultyInDept}</small>
                         </div>
                     `;
                }
            });

            dashboardContent.innerHTML = `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">👨‍🏫</div>
                            <div class="card-title">Total Faculty</div>
                        </div>
                        <div class="card-value">${facultyCount}</div>
                        <div class="card-description">Total faculty members in the college.</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">👨‍🎓</div>
                            <div class="card-title">Total Students</div>
                        </div>
                        <div class="card-value">${studentCount}</div>
                        <div class="card-description">Total students enrolled in the college.</div>
                    </div>
                </div>
                 <div class="list-container">
                    <h3>College Overview by Department</h3>
                    <div class="list-group">
                        ${departmentsHTML}
                    </div>
                </div>
            `;
        }

        function loadStudentDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            const studentActivities = activities.filter(a => a.studentId === currentUser.id);
            const approvedActivities = studentActivities.filter(a => a.status === 'approved');
            
            const myDepartmentFaculty = facultyList.filter(f => f.department === currentUser.branch);

            const facultyListHTML = myDepartmentFaculty.map(faculty => `
                <div class="list-item">
                    <strong>${faculty.name}</strong> (${faculty.id})
                    <br><small>${faculty.designation}, ${faculty.department}</small>
                </div>
            `).join('');
            
            const internshipsCount = approvedActivities.filter(a => a.type === 'internship').length;
            const workshopsCount = approvedActivities.filter(a => a.type === 'workshop').length;
            const competitionsCount = approvedActivities.filter(a => a.type === 'competition').length;
            const certificationsCount = approvedActivities.filter(a => a.type === 'certification').length;
            
            const totalWorkingDays = 365;
            const leaveDays = Math.round(totalWorkingDays * (1 - (currentUser.attendance || 0) / 100));

            const dashboardHTML = `
                <div class="dashboard-grid">
                    <div class="dashboard-card" onclick="showDashboardDetails('academic')">
                        <div class="card-header">
                            <div class="card-icon">📊</div>
                            <div class="card-title">Academic Performance</div>
                        </div>
                        <div class="card-value">${currentUser.cgpa || 'N/A'}</div>
                        <div class="card-description">Current CGPA</div>
                        <div class="details hidden" id="details-academic">
                            <p><strong>Branch:</strong> ${currentUser.branch}</p>
                            <p><strong>Year:</strong> ${currentUser.year}</p>
                        </div>
                    </div>

                    <div class="dashboard-card" onclick="showDashboardDetails('attendance')">
                        <div class="card-header">
                            <div class="card-icon">✅</div>
                            <div class="card-title">Attendance</div>
                        </div>
                        <div class="card-value">${currentUser.attendance || 0}%</div>
                        <div class="card-description">Overall attendance rate</div>
                        <div class="details hidden" id="details-attendance">
                            <p><strong>Total Leave Days:</strong> ${leaveDays} days</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" onclick="showDashboardDetails('internships')">
                        <div class="card-header">
                            <div class="card-icon">💼</div>
                            <div class="card-title">Internships</div>
                        </div>
                        <div class="card-value">${internshipsCount}</div>
                        <div class="card-description">Completed internships</div>
                        <div class="details hidden" id="details-internships">
                             ${approvedActivities.filter(a => a.type === 'internship').map(a => `<p>• ${a.name}</p>`).join('') || '<p>No internships to display.</p>'}
                        </div>
                    </div>

                    <div class="dashboard-card" onclick="showDashboardDetails('workshops')">
                        <div class="card-header">
                            <div class="card-icon">🛠️</div>
                            <div class="card-title">Workshops</div>
                        </div>
                        <div class="card-value">${workshopsCount}</div>
                        <div class="card-description">Attended workshops</div>
                        <div class="details hidden" id="details-workshops">
                             ${approvedActivities.filter(a => a.type === 'workshop').map(a => `<p>• ${a.name}</p>`).join('') || '<p>No workshops to display.</p>'}
                        </div>
                    </div>
                    
                    <div class="dashboard-card" onclick="showDashboardDetails('competitions')">
                        <div class="card-header">
                            <div class="card-icon">🏆</div>
                            <div class="card-title">Competitions</div>
                        </div>
                        <div class="card-value">${competitionsCount}</div>
                        <div class="card-description">Competitions Participated</div>
                        <div class="details hidden" id="details-competitions">
                            ${approvedActivities.filter(a => a.type === 'competition').map(a => `<p>• ${a.name}</p>`).join('') || '<p>No competitions to display.</p>'}
                        </div>
                    </div>

                    <div class="dashboard-card" onclick="showDashboardDetails('certifications')">
                        <div class="card-header">
                            <div class="card-icon">🎓</div>
                            <div class="card-title">Certifications</div>
                        </div>
                        <div class="card-value">${certificationsCount}</div>
                        <div class="card-description">Earned Certifications</div>
                        <div class="details hidden" id="details-certifications">
                            ${approvedActivities.filter(a => a.type === 'certification').map(a => `<p>• ${a.name}</p>`).join('') || '<p>No certifications to display.</p>'}
                        </div>
                    </div>
                </div>
                
                <div class="list-container">
                    <h3>Faculty in Your Department (${currentUser.branch})</h3>
                    <div class="list-group">
                        ${facultyListHTML.length > 0 ? facultyListHTML : '<p>No faculty found in your department.</p>'}
                    </div>
                </div>
            `;
            
            dashboardContent.innerHTML = dashboardHTML;
        }
        
        function showDashboardDetails(type) {
            const detailsElement = document.getElementById(`details-${type}`);
            if (detailsElement) {
                detailsElement.classList.toggle('hidden');
            }
        }
        
        function loadFacultyDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            const pendingApprovalsCount = activities.filter(a => a.facultyId === currentUser.id && a.status === 'pending').length;
            const totalApproved = activities.filter(a => a.facultyId === currentUser.id && a.status === 'approved').length;
            const myDepartmentStudents = mockUsers.students.filter(s => s.branch === currentUser.department);
            const studentsRegisteredByFaculty = mockUsers.students.filter(s => s.registeredByFacultyId === currentUser.id);

            const studentListHTML = myDepartmentStudents.map(student => `
                <div class="list-item" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${student.name}</strong> (${student.id})
                        <br><small>Year: ${student.year}, CGPA: ${student.cgpa || 'N/A'}</small>
                    </div>
                    <button class="btn btn-secondary btn-small view-profile-btn" data-student-id="${student.id}">View Profile</button>
                </div>
            `).join('');
            
            const dashboardHTML = `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">⏳</div>
                            <div class="card-title">Pending Approvals</div>
                        </div>
                        <div class="card-value">${pendingApprovalsCount}</div>
                        <div class="card-description">Activities awaiting approval</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">✅</div>
                            <div class="card-title">Total Approved</div>
                        </div>
                        <div class="card-value">${totalApproved}</div>
                        <div class="card-description">Activities approved so far</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">👥</div>
                            <div class="card-title">Students Registered</div>
                        </div>
                        <div class="card-value">${studentsRegisteredByFaculty.length}</div>
                        <div class="card-description">Students registered by you</div>
                    </div>
                </div>
                
                <div class="list-container">
                    <h3>Students in Your Department (${currentUser.department})</h3>
                    <div class="list-group">
                        ${studentListHTML.length > 0 ? studentListHTML : '<p>No students found in your department.</p>'}
                    </div>
                </div>
            `;
            
            dashboardContent.innerHTML = dashboardHTML;
        }
        
        function showStudentProfile(studentId) {
            const student = mockUsers.students.find(s => s.id === studentId);
            if (!student) {
                showNotification('Student not found.', 'error');
                return;
            }
            
            const approvedActivities = activities.filter(a => a.studentId === student.id && a.status === 'approved');
            
            const profileHTML = `
                <div class="profile-card">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div class="profile-avatar">👨‍🎓</div>
                        <h3>${student.name}</h3>
                        <p style="color: #6b7280;">Student</p>
                    </div>
                    <div style="display: grid; gap: 1rem;">
                        <div><strong>Student ID:</strong> ${student.id}</div>
                        <div><strong>Email:</strong> ${student.email}</div>
                        <div><strong>Branch:</strong> ${student.branch || 'N/A'}</div>
                        <div><strong>Year:</strong> ${student.year || 'N/A'}</div>
                        <div><strong>CGPA:</strong> ${student.cgpa || 'N/A'}</div>
                        <div><strong>Skills:</strong> ${student.skills ? student.skills.join(', ') : 'N/A'}</div>
                        <div><strong>Interests:</strong> ${student.interests ? student.interests.join(', ') : 'N/A'}</div>
                        <div><strong>Approved Activities:</strong> ${approvedActivities.length}</div>
                    </div>
                </div>
            `;
            document.getElementById('studentProfileDetails').innerHTML = profileHTML;
            document.getElementById('studentProfileModal').style.display = 'flex';
        }
        
        function closeStudentProfileModal() {
            document.getElementById('studentProfileModal').style.display = 'none';
        }

        function generatePortfolio() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text(`Student Portfolio - ${currentUser.name}`, 20, 20);
            doc.text(`Student ID: ${currentUser.id}`, 20, 30);
            doc.text(`Branch: ${currentUser.branch}`, 20, 40);
            doc.text(`Email: ${currentUser.email}`, 20, 50);
            doc.text(`CGPA: ${currentUser.cgpa || 'N/A'}`, 20, 60);
            doc.text(`Approved Activities`, 20, 80);

            const approvedActivities = activities.filter(a => a.studentId === currentUser.id && a.status === 'approved');
            let y = 90;

            if (approvedActivities.length > 0) {
                approvedActivities.forEach((activity, index) => {
                    doc.text(`${index + 1}. ${activity.name} (${activity.type})`, 25, y);
                    doc.text(`- Description: ${activity.description}`, 30, y + 5);
                    doc.text(`- Approved by: ${facultyList.find(f => f.id === activity.facultyId)?.name}`, 30, y + 10);
                    y += 20;
                });
            } else {
                doc.text('No approved activities yet.', 25, y);
            }

            doc.save(`${currentUser.name}_Portfolio.pdf`);
            showNotification('Portfolio generated and downloaded successfully!', 'success');
        }


        // Activity Management Functions
        function loadActivities() {
            if (userType === 'student') {
                loadStudentActivities();
                document.getElementById('studentActivityForm').classList.remove('hidden');
                document.getElementById('facultyApprovalPanel').classList.add('hidden');
                document.getElementById('approvedRejectedList').classList.add('hidden');
            } else {
                loadFacultyApprovals();
                document.getElementById('studentActivityForm').classList.add('hidden');
                document.getElementById('facultyApprovalPanel').classList.remove('hidden');
                document.getElementById('approvedRejectedList').classList.remove('hidden');
                loadFacultyApprovedRejectedActivities();
            }
        }
        
        function loadFacultyApprovedRejectedActivities() {
            const approvedRejectedList = document.getElementById('approvedRejectedItems');
            const facultyActivities = activities.filter(a => a.facultyId === currentUser.id && (a.status === 'approved' || a.status === 'rejected'));
            
            if (facultyActivities.length === 0) {
                approvedRejectedList.innerHTML = '<p>No approved or rejected activities yet.</p>';
                return;
            }

            const itemsHTML = facultyActivities.map(activity => {
                const student = mockUsers.students.find(s => s.id === activity.studentId);
                const statusClass = activity.status === 'approved' ? 'approved' : 'rejected';
                
                return `
                    <div class="approval-item ${statusClass}">
                        <div>
                            <strong>${activity.name}</strong>
                            <p>Student: ${student ? student.name : 'Unknown'} (${activity.studentId})</p>
                            <p>Status: ${activity.status.toUpperCase()}</p>
                            <small>Date: ${new Date(activity.approvedAt || activity.rejectedAt).toLocaleDateString()}</small>
                        </div>
                    </div>
                `;
            }).join('');
            
            approvedRejectedList.innerHTML = itemsHTML;
        }

        function loadStudentActivities() {
            const studentActivities = activities.filter(a => a.studentId === currentUser.id);
            const pendingList = document.getElementById('pendingApprovalsList');
            
            if (studentActivities.length === 0) {
                pendingList.innerHTML = '<p>No activities submitted yet.</p>';
                return;
            }
            
            const activitiesHTML = studentActivities.map(activity => {
                const faculty = facultyList.find(f => f.id === activity.facultyId);
                const statusClass = activity.status === 'approved' ? 'approved' : 
                                   activity.status === 'rejected' ? 'rejected' : '';
                
                return `
                    <div class="approval-item ${statusClass}">
                        <div>
                            <strong>${activity.name}</strong>
                            <p>Supervisor: ${faculty ? faculty.name : 'Unknown'}</p>
                            <p>Status: ${activity.status.toUpperCase()}</p>
                            <small>Submitted: ${new Date(activity.submittedAt).toLocaleDateString()}</small>
                            ${activity.approvedAt ? `<small> | Approved: ${new Date(activity.approvedAt).toLocaleDateString()}</small>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            pendingList.innerHTML = activitiesHTML;
        }

        function loadFacultyApprovals() {
            const pendingApprovals = activities.filter(a => a.facultyId === currentUser.id && a.status === 'pending');
            const approvalQueue = document.getElementById('approvalQueue');
            
            if (pendingApprovals.length === 0) {
                approvalQueue.innerHTML = '<p>No activities pending approval.</p>';
                return;
            }
            
            const approvalsHTML = pendingApprovals.map(activity => {
                const student = mockUsers.students.find(s => s.id === activity.studentId);
                
                return `
                    <div class="approval-item">
                        <div>
                            <strong>${activity.name}</strong>
                            <p>Student: ${student ? student.name : 'Unknown'} (${activity.studentId})</p>
                            <p>Type: ${activity.type}</p>
                            <p>Description: ${activity.description}</p>
                            <small>Submitted: ${new Date(activity.submittedAt).toLocaleDateString()}</small>
                        </div>
                        <div class="approval-actions">
                            <button class="btn-small btn-approve" onclick="approveActivity('${activity.id}')">Approve</button>
                            <button class="btn-small btn-reject" onclick="rejectActivity('${activity.id}')">Reject</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            approvalQueue.innerHTML = approvalsHTML;
        }

        function handleActivitySubmission(e) {
            e.preventDefault();
            
            const newActivity = {
                id: `ACT${String(activities.length + 1).padStart(3, '0')}`,
                studentId: currentUser.id,
                type: document.getElementById('activityType').value,
                name: document.getElementById('activityName').value,
                description: document.getElementById('activityDescription').value,
                facultyId: document.getElementById('selectedFacultyId').value,
                status: 'pending',
                submittedAt: new Date(),
                file: document.getElementById('activityFile').files[0]?.name || ''
            };
            
            activities.push(newActivity);
            
            document.getElementById('activitySubmissionForm').reset();
            document.getElementById('facultySearch').value = '';
            document.getElementById('selectedFacultyId').value = '';
            
            loadStudentActivities();
            showNotification('Activity submitted successfully!', 'success');
            
            setTimeout(() => {
                if (wsConnection) {
                    wsConnection.send(JSON.stringify({
                        type: 'new_activity',
                        activityId: newActivity.id,
                        facultyId: newActivity.facultyId
                    }));
                }
            }, 1000);
        }

        function handleFacultySearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const dropdown = document.getElementById('facultyDropdown');
            const myDepartmentFaculty = facultyList.filter(f => f.department === currentUser.branch);
            
            if (searchTerm.length < 2) {
                dropdown.style.display = 'none';
                return;
            }
            
            const matchedFaculty = myDepartmentFaculty.filter(faculty => 
                faculty.name.toLowerCase().includes(searchTerm) ||
                faculty.id.toLowerCase().includes(searchTerm) ||
                faculty.department.toLowerCase().includes(searchTerm)
            );
            
            if (matchedFaculty.length > 0) {
                const optionsHTML = matchedFaculty.map(faculty => 
                    `<div class="faculty-option" onclick="selectFaculty('${faculty.id}', '${faculty.name}')">
                        <strong>${faculty.name}</strong> (${faculty.id})
                        <br><small>${faculty.department}</small>
                    </div>`
                ).join('');
                
                dropdown.innerHTML = optionsHTML;
                dropdown.style.display = 'block';
            } else {
                dropdown.style.style.display = 'none';
                dropdown.innerHTML = `<div style="padding: 1rem;">No faculty found.</div>`;
            }
        }

        function selectFaculty(facultyId, facultyName) {
            document.getElementById('facultySearch').value = facultyName;
            document.getElementById('selectedFacultyId').value = facultyId;
            document.getElementById('facultyDropdown').style.display = 'none';
        }

        function approveActivity(activityId) {
            const activity = activities.find(a => a.id === activityId);
            if (activity) {
                activity.status = 'approved';
                activity.approvedAt = new Date();
                
                loadFacultyApprovals();
                loadFacultyApprovedRejectedActivities();
                showNotification('Activity approved successfully!', 'success');
                
                if (wsConnection) {
                    wsConnection.send(JSON.stringify({
                        type: 'activity_approved',
                        activityId,
                        studentId: activity.studentId
                    }));
                }
            }
        }

        function rejectActivity(activityId) {
            const activity = activities.find(a => a.id === activityId);
            if (activity) {
                activity.status = 'rejected';
                activity.rejectedAt = new Date();
                
                loadFacultyApprovals();
                loadFacultyApprovedRejectedActivities();
                showNotification('Activity rejected!', 'error');
                
                if (wsConnection) {
                    wsConnection.send(JSON.stringify({
                        type: 'activity_rejected',
                        activityId,
                        studentId: activity.studentId
                    }));
                }
            }
        }

        // Real-time Updates
        function setupRealTimeUpdates() {
            wsConnection = {
                send: (data) => {
                    console.log('WebSocket message sent:', data);
                    setTimeout(() => {
                        const message = JSON.parse(data);
                        handleRealTimeUpdate(message);
                    }, 500);
                }
            };
            
            setInterval(() => {
                updateLiveIndicators();
                refreshRecommendations();
            }, 30000);
        }

        function handleRealTimeUpdate(message) {
            switch (message.type) {
                case 'new_activity':
                    if (userType === 'faculty' && currentUser.id === message.facultyId) {
                        showNotification('New activity submitted for your approval!', 'info');
                        loadFacultyApprovals();
                    }
                    break;
                case 'activity_approved':
                    if (userType === 'student' && currentUser.id === message.studentId) {
                        showNotification('Your activity has been approved!', 'success');
                        loadStudentActivities();
                        loadDashboard();
                    }
                    break;
                case 'activity_rejected':
                    if (userType === 'student' && currentUser.id === message.studentId) {
                        showNotification('Your activity was rejected. Please check with your supervisor.', 'error');
                        loadStudentActivities();
                    }
                    break;
            }
        }

        function updateLiveIndicators() {
            const indicators = document.querySelectorAll('.live-indicator');
            indicators.forEach(indicator => {
                indicator.style.animationDuration = Math.random() * 2 + 1 + 's';
            });
        }

        // Recommendations System (Only for Students)
        function loadRecommendations() {
            if (userType === 'faculty') {
                return;
            }
            
            setTimeout(() => {
                loadInternshipRecommendations();
            }, 1000);
            
            setTimeout(() => {
                loadScholarshipRecommendations();
            }, 1500);
            
            setTimeout(() => {
                loadJobRecommendations();
            }, 2000);
            
            setTimeout(() => {
                loadEventRecommendations();
            }, 2500);
        }

        function loadInternshipRecommendations() {
            const recommendations = [
                { title: "Software Development Intern", company: "TechCorp", match: "95%", location: "Bangalore", lastDate: "2025-10-15", applyLink: "#", learnMoreLink: "#" },
                { title: "Data Science Intern", company: "DataTech", match: "88%", location: "Hyderabad", lastDate: "2025-10-20", applyLink: "#", learnMoreLink: "#" },
                { title: "ML Engineering Intern", company: "AI Solutions", match: "92%", location: "Pune", lastDate: "2025-10-25", applyLink: "#", learnMoreLink: "#" },
                { title: "Full Stack Developer Intern", company: "WebTech", match: "90%", location: "Chennai", lastDate: "2025-10-30", applyLink: "#", learnMoreLink: "#" }
            ];
            const container = document.getElementById('internship-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.company} - ${item.location}</p>
                    <small>Match: ${item.match}</small>
                    <div class="recommendation-meta">
                         <span>Last Date: ${item.lastDate}</span>
                         <div>
                            <a href="${item.applyLink}" class="btn btn-primary btn-small">Apply Now</a>
                            <a href="${item.learnMoreLink}" class="btn btn-secondary btn-small">Learn More</a>
                         </div>
                    </div>
                </div>
            `).join('');
        }

        function loadScholarshipRecommendations() {
            const recommendations = [
                { title: "Merit Scholarship for CS Students", provider: "Tech Foundation", amount: "₹50,000", lastDate: "2025-11-01", applyLink: "#", learnMoreLink: "#" },
                { title: "Innovation Excellence Award", provider: "Government of India", amount: "₹75,000", lastDate: "2025-11-10", applyLink: "#", learnMoreLink: "#" },
                { title: "Women in Tech Scholarship", provider: "WiT Foundation", amount: "₹1,00,000", lastDate: "2025-11-15", applyLink: "#", learnMoreLink: "#" },
                { title: "Open Source Contributor Grant", provider: "OSS India", amount: "₹25,000", lastDate: "2025-11-20", applyLink: "#", learnMoreLink: "#" }
            ];
            const container = document.getElementById('scholarship-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.provider}</p>
                    <small>Amount: ${item.amount}</small>
                    <div class="recommendation-meta">
                         <span>Last Date: ${item.lastDate}</span>
                         <div>
                            <a href="${item.applyLink}" class="btn btn-primary btn-small">Apply Now</a>
                            <a href="${item.learnMoreLink}" class="btn btn-secondary btn-small">Learn More</a>
                         </div>
                    </div>
                </div>
            `).join('');
        }

        function loadJobRecommendations() {
            const recommendations = [
                { title: "Junior Software Engineer", company: "Infosys", salary: "₹4.5 LPA", experience: "0-1 years", lastDate: "2025-12-01", applyLink: "#", learnMoreLink: "#" },
                { title: "Python Developer", company: "Wipro", salary: "₹5.2 LPA", experience: "0-2 years", lastDate: "2025-12-05", applyLink: "#", learnMoreLink: "#" },
                { title: "Data Analyst", company: "TCS", salary: "₹4.8 LPA", experience: "0-1 years", lastDate: "2025-12-10", applyLink: "#", learnMoreLink: "#" },
                { title: "Frontend Developer", company: "Accenture", salary: "₹5.0 LPA", experience: "0-2 years", lastDate: "2025-12-15", applyLink: "#", learnMoreLink: "#" }
            ];
            const container = document.getElementById('job-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.company}</p>
                    <small>Salary: ${item.salary} | Experience: ${item.experience}</small>
                    <div class="recommendation-meta">
                         <span>Last Date: ${item.lastDate}</span>
                         <div>
                            <a href="${item.applyLink}" class="btn btn-primary btn-small">Apply Now</a>
                            <a href="${item.learnMoreLink}" class="btn btn-secondary btn-small">Learn More</a>
                         </div>
                    </div>
                </div>
            `).join('');
        }

        function loadEventRecommendations() {
            const recommendations = [
                { title: "AI/ML Workshop", date: "Oct 15, 2025", organizer: "IEEE Student Chapter", type: "Workshop", lastDate: "2025-10-10", applyLink: "#", learnMoreLink: "#" },
                { title: "Hackathon 2025", date: "Nov 20, 2025", organizer: "CodeChef", type: "Competition", lastDate: "2025-11-18", applyLink: "#", learnMoreLink: "#" },
                { title: "Tech Conference", date: "Dec 5, 2025", organizer: "Google Developers", type: "Conference", lastDate: "2025-12-01", applyLink: "#", learnMoreLink: "#" },
                { title: "Career Fair", date: "Jan 10, 2026", organizer: "University", type: "Fair", lastDate: "2026-01-08", applyLink: "#", learnMoreLink: "#" }
            ];
            const container = document.getElementById('event-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.organizer}</p>
                    <small>Date: ${item.date} | Type: ${item.type}</small>
                    <div class="recommendation-meta">
                         <span>Last Date: ${item.lastDate}</span>
                         <div>
                            <a href="${item.applyLink}" class="btn btn-primary btn-small">Apply Now</a>
                            <a href="${item.learnMoreLink}" class="btn btn-secondary btn-small">Learn More</a>
                         </div>
                    </div>
                </div>
            `).join('');
        }

        function refreshRecommendations() {
            if (currentUser && userType === 'student') {
                loadRecommendations();
            }
        }

        // Chatbot Functions
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.style.display = chatWindow.style.display === 'flex' ? 'none' : 'flex';
            
            if (chatWindow.style.display === 'flex') {
                if (currentUser && !chatWindow.dataset.initialized) {
                    addMessage(`Hello ${currentUser.name}! I'm here to help you with your academic journey. What would you like to know?`, 'bot');
                    chatWindow.dataset.initialized = 'true';
                }
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot typing';
            typingDiv.innerHTML = 'Assistant is typing...';
            document.getElementById('chatMessages').appendChild(typingDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;


            getAIResponse(message).then(response => {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages.lastChild === typingDiv) {
                    chatMessages.removeChild(typingDiv);
                }
                addMessage(response, 'bot');
            }).catch(() => {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages.lastChild === typingDiv) {
                    chatMessages.removeChild(typingDiv);
                }
                addMessage('Sorry, I am unable to connect with the AI right now. Please try again later.', 'bot');
            });
        }

        async function getAIResponse(message) {
            const prompt = `You are a helpful assistant for the Smart Student Hub platform.
                            Current user data:
                            Name: ${currentUser?.name || 'Guest'}
                            User Type: ${userType || 'unknown'}
                            Branch/Department: ${currentUser?.branch || currentUser?.department || 'N/A'}
                            Activities: ${JSON.stringify(activities.filter(a => a.studentId === currentUser?.id))}
                            
                            Based on this context, provide a helpful and professional response to the following query:
                            ${message}`;
            try {
                const response = await fetch(geminiApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                const data = await response.json();
                if (data.candidates && data.candidates.length > 0) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    return 'Sorry, I could not generate a response. Please try again.';
                }
            } catch (error) {
                console.error('Gemini API Error:', error);
                throw new Error('API request failed');
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function handleStudentRegistration(e) {
            e.preventDefault();

            const studentId = document.getElementById('regStudentId').value;
            const studentName = document.getElementById('regStudentName').value;
            const studentEmail = document.getElementById('regStudentEmail').value;
            const studentBranch = document.getElementById('regStudentBranch').value;
            const studentYear = document.getElementById('regStudentYear').value;
            const studentCgpa = document.getElementById('regStudentCgpa').value;
            const studentAttendance = document.getElementById('regStudentAttendance').value;
            const studentPassword = document.getElementById('regStudentPassword').value;
            const facultySupervisorId = document.getElementById('regStudentSupervisor').value;

            if (mockUsers.students.find(s => s.id === studentId)) {
                showNotification('Student ID already exists!', 'error');
                return;
            }

            const newStudent = {
                id: studentId,
                name: studentName,
                email: studentEmail,
                password: studentPassword,
                branch: studentBranch,
                year: studentYear,
                cgpa: parseFloat(studentCgpa),
                attendance: parseFloat(studentAttendance),
                skills: [],
                interests: [],
                registeredByFacultyId: facultySupervisorId
            };
            mockUsers.students.push(newStudent);
            
            e.target.reset();
            loadAdminDashboard();
            showNotification('Student registered successfully!', 'success');
        }

        function handleFacultyRegistration(e) {
             e.preventDefault();
            
            const facultyId = document.getElementById('regFacultyId').value;
            const facultyName = document.getElementById('regFacultyName').value;
            const facultyEmail = document.getElementById('regFacultyEmail').value;
            const facultyDepartment = document.getElementById('regFacultyDepartment').value;
            const facultyDesignation = document.getElementById('regFacultyDesignation').value;
            const facultyPassword = document.getElementById('regFacultyPassword').value;
            
            if (mockUsers.faculty.find(f => f.id === facultyId)) {
                showNotification('Faculty ID already exists!', 'error');
                return;
            }

            const newFaculty = {
                id: facultyId,
                name: facultyName,
                email: facultyEmail,
                password: facultyPassword,
                department: facultyDepartment,
                designation: facultyDesignation,
            };
            mockUsers.faculty.push(newFaculty);
            facultyList.push(newFaculty);
            
            e.target.reset();
            loadAdminDashboard();
            showNotification('Faculty registered successfully!', 'success');
        }

        function updateFacultySupervisorOptions() {
            const supervisorSelect = document.getElementById('regStudentSupervisor');
            const studentBranch = document.getElementById('regStudentBranch').value;
            
            supervisorSelect.innerHTML = '<option value="">Select Supervisor</option>';

            const filteredFaculty = mockUsers.faculty.filter(f => f.department === studentBranch);
            filteredFaculty.forEach(faculty => {
                const option = document.createElement('option');
                option.value = faculty.id;
                option.textContent = `${faculty.name} (${faculty.id})`;
                supervisorSelect.appendChild(option);
            });
        }


        function searchStudent() {
            const searchTerm = document.getElementById('studentSearchInput').value.toLowerCase();
            const searchResultsContainer = document.getElementById('studentSearchItems');
            
            if (searchTerm.length < 3) {
                searchResultsContainer.innerHTML = '<p>Please enter at least 3 characters to search.</p>';
                return;
            }
            
            const results = mockUsers.students.filter(s => 
                s.name.toLowerCase().includes(searchTerm) || s.id.toLowerCase() === searchTerm
            );

            if (results.length === 0) {
                searchResultsContainer.innerHTML = '<p>No students found matching your search.</p>';
                return;
            }

            const resultsHTML = results.map(student => {
                 const approvedActivities = activities.filter(a => a.studentId === student.id && a.status === 'approved');
                 return `
                     <div class="profile-card">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <h3>${student.name}</h3>
                            <p style="color: #6b7280;">Student</p>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Student ID:</strong> ${student.id}</div>
                            <div><strong>Branch:</strong> ${student.branch || 'N/A'}</div>
                            <div><strong>Year:</strong> ${student.year || 'N/A'}</div>
                            <div><strong>CGPA:</strong> ${student.cgpa || 'N/A'}</div>
                            <div><strong>Approved Activities:</strong> ${approvedActivities.length}</div>
                        </div>
                    </div>
                 `;
            }).join('');
            
            searchResultsContainer.innerHTML = resultsHTML;
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'info' ? '#3b82f6' : '#f59e0b'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                z-index: 1003;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
    </script>
</body>
</html>

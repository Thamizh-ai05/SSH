<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Student Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8fafc;
        }

        /* Navigation */
        .navbar {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            color: white;
            padding: 1rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn-auth {
            padding: 0.5rem 1rem;
            border: 1px solid white;
            background: transparent;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-auth:hover {
            background: white;
            color: #2563eb;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mobile-menu {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Auth Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #6b7280;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
        }

        .user-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .user-type {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-type.selected {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #2563eb, #1e40af, #3b82f6);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: white;
            color: #2563eb;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: #2563eb;
        }

        /* Dashboard & Profile Section */
        .dashboard, .profile-section {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard h2, .profile-section h2 {
            color: #1e40af;
            margin-bottom: 2rem;
            font-size: 2.5rem;
            text-align: center;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.3rem;
            color: #1e40af;
            font-weight: 600;
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #059669;
            margin: 1rem 0;
        }

        .card-description {
            color: #6b7280;
        }
        
        /* Profile specific styles */
        .profile-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
        }

        .profile-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #1e40af;
        }

        .profile-card p {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .list-container {
            margin-top: 2rem;
        }
        
        .list-container h3 {
            font-size: 1.5rem;
            color: #1e40af;
            margin-bottom: 1rem;
        }
        
        .list-group {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }
        
        .list-item {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        /* Activity Tracker */
        .activity-tracker {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .activity-form {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .faculty-search {
            position: relative;
            margin-bottom: 1rem;
        }

        .faculty-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .faculty-option {
            padding: 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.3s ease;
        }

        .faculty-option:hover {
            background: #f3f4f6;
        }

        .pending-approvals {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        .approval-item {
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #fef3c7;
            border-radius: 0 10px 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .approval-item.approved {
            border-left-color: #10b981;
            background: #d1fae5;
        }

        .approval-item.rejected {
            border-left-color: #ef4444;
            background: #fee2e2;
        }

        .approval-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-approve {
            background: #10b981;
            color: white;
        }

        .btn-reject {
            background: #ef4444;
            color: white;
        }

        /* Faculty Dashboard */
        .faculty-dashboard {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .approval-queue {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        /* Recommendations */
        .recommendations {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .recommendation-category {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
        }

        .recommendation-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            border-color: #3b82f6;
            transform: translateX(5px);
        }

        /* Chatbot */
        .chatbot-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .chatbot-button:hover {
            transform: scale(1.1);
        }

        .chatbot-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            display: none;
            flex-direction: column;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 1rem;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 10px;
            animation: fadeIn 0.3s ease;
        }

        .message.bot {
            background: #f3f4f6;
            align-self: flex-start;
        }

        .message.user {
            background: #3b82f6;
            color: white;
            align-self: flex-end;
            margin-left: auto;
            max-width: 80%;
        }

        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
        }

        .chatbot-input input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #e5e7eb;
            border-radius: 25px;
            outline: none;
        }

        .chatbot-input button {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }

        /* Real-time updates */
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Footer */
        .footer {
            background: #1f2937;
            color: white;
            padding: 3rem 2rem 1rem;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: #3b82f6;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .social-icon:hover {
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: #1e40af;
                flex-direction: column;
                padding: 1rem;
                display: none;
            }

            .nav-menu.active {
                display: flex;
            }

            .mobile-menu {
                display: block;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .chatbot-window {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Loading spinner */
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .printable-content, .printable-content * {
                visibility: visible;
            }
            .printable-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                📚 Smart Student Hub
            </div>
            <ul class="nav-menu">
                <li><a href="#" class="nav-link active" data-section="home">Home</a></li>
                <li><a href="#" class="nav-link" data-section="dashboard">Dashboard</a></li>
                <li><a href="#" class="nav-link" data-section="activities">Activities</a></li>
                <li id="recommendations-nav-link"><a href="#" class="nav-link" data-section="recommendations">Recommendations</a></li>
            </ul>
            <div class="auth-buttons" id="authButtons">
                <button class="btn-auth" onclick="openModal('login')">Login</button>
            </div>
            <div class="user-info hidden" id="userInfo">
                <span class="live-indicator"></span>
                <span id="userWelcome"></span>
                <button class="btn-auth" onclick="logout()">Logout</button>
            </div>
            <button class="mobile-menu">☰</button>
        </div>
    </nav>

    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="auth-tabs">
                <button class="auth-tab active">Login</button>
            </div>

            <div class="user-type-selector" id="userTypeSelector">
                <div class="user-type selected" data-type="student">
                    <div style="font-size: 2rem;">👨‍🎓</div>
                    <div>Student</div>
                </div>
                <div class="user-type" data-type="faculty">
                    <div style="font-size: 2rem;">👨‍🏫</div>
                    <div>Faculty</div>
                </div>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label>Email/ID</label>
                    <input type="text" id="loginId" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>

            <button onclick="closeModal()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
        </div>
    </div>

    <main class="main-content">
        <section id="home" class="section active">
            <div class="hero" id="hero-section">
                <div class="hero-content">
                    <h1>Smart Student Hub</h1>
                    <p>A Centralised Digital Platform for Student Achievements</p>
                    <div class="hero-buttons">
                        <button class="btn btn-primary" onclick="openModal()">Login</button>
                        <button class="btn btn-secondary">Learn More</button>
                    </div>
                </div>
            </div>
            <div id="profile-content" class="profile-section hidden"></div>
        </section>

        <section id="dashboard" class="section">
            <div class="dashboard">
                <h2 id="dashboardTitle">Dashboard</h2>
                <div id="dashboardContent">
                    </div>
            </div>
        </section>

        <section id="activities" class="section">
            <div class="activity-tracker">
                <h2 style="color: #1e40af; margin-bottom: 2rem; font-size: 2.5rem; text-align: center;">Activity Tracker</h2>
                
                <div class="activity-form" id="studentActivityForm">
                    <h3 style="margin-bottom: 1.5rem; color: #374151;">Submit New Activity</h3>
                    <form id="activitySubmissionForm">
                        <div class="form-group">
                            <label>Activity Type</label>
                            <select id="activityType" required>
                                <option value="">Select Activity Type</option>
                                <option value="workshop">Workshop</option>
                                <option value="competition">Competition</option>
                                <option value="internship">Internship</option>
                                <option value="certification">Certification</option>
                                <option value="volunteer">Volunteer Work</option>
                                <option value="research">Research Project</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Event/Activity Name</label>
                            <input type="text" id="activityName" required>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea rows="4" id="activityDescription" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Faculty Supervisor</label>
                            <div class="faculty-search">
                                <input type="text" id="facultySearch" placeholder="Search faculty by name or ID..." required>
                                <div class="faculty-dropdown" id="facultyDropdown"></div>
                            </div>
                            <input type="hidden" id="selectedFacultyId">
                        </div>
                        <div class="form-group">
                            <label>Certificate/Proof (PDF/Image)</label>
                            <input type="file" id="activityFile" accept=".pdf,.jpg,.jpeg,.png" required>
                        </div>
                        <div class="form-group">
                            <label>Date of Activity</label>
                            <input type="date" id="activityDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit for Approval</button>
                    </form>
                </div>

                <div class="faculty-dashboard hidden" id="facultyApprovalPanel">
                    <h3 style="margin-bottom: 1.5rem; color: #374151;">Faculty Approval Panel</h3>
                    <div class="approval-queue" id="approvalQueue">
                        </div>
                </div>

                <div class="pending-approvals">
                    <h3 style="margin-bottom: 1.5rem; color: #374151;">
                        <span class="live-indicator"></span>
                        Activity Status (Live Updates)
                    </h3>
                    <div id="pendingApprovalsList">
                        </div>
                </div>
            </div>
        </section>

        <section id="recommendations" class="section">
            <div class="recommendations">
                <h2 style="color: #1e40af; margin-bottom: 2rem; font-size: 2.5rem; text-align: center;">
                    <span class="live-indicator"></span>
                    Personalized Recommendations
                </h2>
                
                <div class="recommendations-grid">
                    <div class="recommendation-category">
                        <h3 style="color: #059669; margin-bottom: 1rem;">🚀 Internships</h3>
                        <div id="internship-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <div class="recommendation-category">
                        <h3 style="color: #7c3aed; margin-bottom: 1rem;">🎓 Scholarships</h3>
                        <div id="scholarship-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <div class="recommendation-category">
                        <h3 style="color: #dc2626; margin-bottom: 1rem;">💼 Jobs</h3>
                        <div id="job-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>

                    <div class="recommendation-category">
                        <h3 style="color: #ea580c; margin-bottom: 1rem;">📅 Events</h3>
                        <div id="event-recommendations">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <button class="chatbot-button" onclick="toggleChat()">💬</button>
    <div class="chatbot-window" id="chatWindow">
        <div class="chatbot-header">
            <span>Smart Assistant</span>
            <button onclick="toggleChat()" style="background: none; border: none; color: white; cursor: pointer;">×</button>
        </div>
        <div class="chatbot-messages" id="chatMessages">
            <div class="message bot">
                Hi! I'm your Smart Student Hub assistant. How can I help you today?
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatInput" placeholder="Type your message..." onkeypress="handleChatEnter(event)">
            <button onclick="sendMessage()">📤</button>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Info</h3>
                <p>📧 info@smartstudenthub.edu</p>
                <p>📞 +91 9876543210</p>
                <p>📍 Delhi, India</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <p>About Us</p>
                <p>Privacy Policy</p>
                <p>Terms of Service</p>
                <p>Support</p>
            </div>
            <div class="footer-section">
                <h3>Features</h3>
                <p>Activity Tracking</p>
                <p>AI Recommendations</p>
                <p>Performance Analytics</p>
                <p>Certificate Management</p>
            </div>
        </div>
        <div class="social-icons">
            <a href="#" class="social-icon">📘</a>
            <a href="#" class="social-icon">🐦</a>
            <a href="#" class="social-icon">💼</a>
            <a href="#" class="social-icon">📷</a>
        </div>
        <p>&copy; 2025 Smart Student Hub. All rights reserved. | SIH Hackathon Project</p>
    </footer>

    <script>
        // Global Variables
        let currentUser = null;
        let userType = null;
        let activities = [];
        let facultyList = [];
        let wsConnection = null;
        const GEMINI_API_KEY = "AIzaSyCYLr5JOxS9dQ0R2eL9k0AhcQXYecbTWdw";
        const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`;

        // Mock Database
        let mockUsers = {
            students: [],
            faculty: []
        };
        const departments = ['Computer Science', 'Electronics', 'Mechanical', 'Civil', 'Chemical'];

        const mockActivities = [
            {
                id: 'ACT001', studentId: 'STU001', type: 'certification', name: 'Google Cloud Certification',
                description: 'Completed Google Cloud Professional certification', facultyId: 'FAC001',
                status: 'pending', submittedAt: new Date('2025-01-15'), file: 'certificate.pdf'
            },
            {
                id: 'ACT002', studentId: 'STU001', type: 'workshop', name: 'React.js Workshop',
                description: 'Attended 3-day React.js workshop', facultyId: 'FAC001',
                status: 'approved', submittedAt: new Date('2025-01-10'), approvedAt: new Date('2025-01-12'), file: 'workshop-certificate.pdf'
            },
            {
                id: 'ACT003', studentId: 'STU003', type: 'competition', name: 'National Robotics Olympiad',
                description: 'Participated in the national robotics competition', facultyId: 'FAC002',
                status: 'pending', submittedAt: new Date('2025-09-20'), file: 'olympiad-certificate.pdf'
            },
            {
                id: 'ACT004', studentId: 'STU004', type: 'research', name: 'AI in Healthcare Research Paper',
                description: 'Co-authored a research paper on AI in diagnostics.', facultyId: 'FAC001',
                status: 'approved', submittedAt: new Date('2025-08-01'), approvedAt: new Date('2025-08-05'), file: 'research-paper.pdf'
            }
        ];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            loadMockData();
            initializeApp();
            setupEventListeners();
            setupRealTimeUpdates();
        });

        function loadMockData() {
            // Mock Admin Panel creating faculty accounts
            mockUsers.faculty = [
                { id: 'FAC001', name: 'Dr. Priya Sharma', email: 'priya.sharma@faculty.edu', password: 'faculty123', department: 'Computer Science', designation: 'Professor' },
                { id: 'FAC002', name: 'Dr. Amit Kumar', email: 'amit.kumar@faculty.edu', password: 'faculty123', department: 'Electronics', designation: 'Associate Professor' }
            ];

            // Mock Faculty creating student accounts
            mockUsers.students = [
                { id: 'STU001', name: 'John Doe', email: 'john.doe@student.edu', password: 'password123', branch: 'Computer Science', year: '3rd Year', cgpa: 8.5, attendance: 92, skills: ['Python', 'Java', 'Web Development'], interests: ['AI/ML', 'Software Development'] },
                { id: 'STU003', name: 'Peter Jones', email: 'peter.jones@student.edu', password: 'password123', branch: 'Computer Science', year: '3rd Year', cgpa: 7.8, attendance: 85, skills: ['C++', 'Algorithms'], interests: ['Competitive Programming'] },
                { id: 'STU004', name: 'Sarah Lee', email: 'sarah.lee@student.edu', password: 'password123', branch: 'Computer Science', year: '4th Year', cgpa: 9.1, attendance: 95, skills: ['ML', 'Data Science'], interests: ['Research', 'AI'] },
                { id: 'STU002', name: 'Jane Smith', email: 'jane.smith@student.edu', password: 'password123', branch: 'Electronics', year: '2nd Year', cgpa: 9.2, attendance: 95, skills: ['Circuit Design', 'IoT'], interests: ['Robotics', 'Embedded Systems'] }
            ];

            facultyList = mockUsers.faculty;
            activities = [...mockActivities];
        }

        function initializeApp() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                userType = localStorage.getItem('userType');
                updateUIForLoggedInUser();
            } else {
                showInitialHomePage();
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    showSection(section);
                });
            });

            document.querySelector('.mobile-menu').addEventListener('click', () => {
                document.querySelector('.nav-menu').classList.toggle('active');
            });

            document.querySelectorAll('.user-type').forEach(type => {
                type.addEventListener('click', () => {
                    document.querySelectorAll('.user-type').forEach(t => t.classList.remove('selected'));
                    type.classList.add('selected');
                });
            });

            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            document.getElementById('activitySubmissionForm').addEventListener('submit', handleActivitySubmission);
            
            document.getElementById('facultySearch').addEventListener('input', handleFacultySearch);
            
            document.body.addEventListener('click', (e) => {
                if (e.target.id === 'generatePortfolioBtn') {
                    generatePortfolio();
                }
            });
        }

        function showInitialHomePage() {
            document.getElementById('hero-section').classList.remove('hidden');
            document.getElementById('profile-content').classList.add('hidden');
        }

        // Authentication Functions
        function openModal() {
            document.getElementById('authModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const loginId = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;
            const selectedUserType = document.querySelector('.user-type.selected').dataset.type;
            
            let user = null;
            if (selectedUserType === 'student') {
                user = mockUsers.students.find(s => 
                    (s.email === loginId || s.id === loginId) && s.password === password
                );
            } else {
                user = mockUsers.faculty.find(f => 
                    (f.email === loginId || f.id === loginId) && f.password === password
                );
            }
            
            if (user) {
                currentUser = user;
                userType = selectedUserType;
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.setItem('userType', selectedUserType);
                
                updateUIForLoggedInUser();
                closeModal();
                showSection('home');
                showNotification('Login successful!', 'success');
            } else {
                showNotification('Invalid credentials!', 'error');
            }
        }

        function logout() {
            currentUser = null;
            userType = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userType');
            
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            
            showInitialHomePage();
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector('[data-section="home"]').classList.add('active');
            document.getElementById('recommendations-nav-link').classList.remove('hidden');

            showNotification('Logged out successfully!', 'success');
        }

        function updateUIForLoggedInUser() {
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.name}`;

            if (userType === 'faculty') {
                document.getElementById('recommendations-nav-link').classList.add('hidden');
            } else {
                document.getElementById('recommendations-nav-link').classList.remove('hidden');
                loadRecommendations();
            }

            loadProfile();
            loadDashboard();
            loadActivities();
        }

        // Navigation Functions
        function showSection(sectionName) {
            if (!currentUser && sectionName !== 'home') {
                showNotification('Please login to access this section!', 'error');
                openModal();
                return;
            }
            
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            const activeLink = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeLink) activeLink.classList.add('active');
        }
        
        // Profile & Dashboard Functions
        function loadProfile() {
            const heroSection = document.getElementById('hero-section');
            const profileContent = document.getElementById('profile-content');
            
            heroSection.classList.add('hidden');
            profileContent.classList.remove('hidden');

            if (userType === 'student') {
                const approvedActivities = activities.filter(a => a.studentId === currentUser.id && a.status === 'approved');
                
                profileContent.innerHTML = `
                    <div class="profile-card printable-content">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="profile-avatar">👨‍🎓</div>
                            <h3>${currentUser.name}</h3>
                            <p style="color: #6b7280;">Student</p>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Student ID:</strong> ${currentUser.id}</div>
                            <div><strong>Email:</strong> ${currentUser.email}</div>
                            <div><strong>Branch:</strong> ${currentUser.branch || 'N/A'}</div>
                            <div><strong>Year:</strong> ${currentUser.year || 'N/A'}</div>
                            <div><strong>CGPA:</strong> ${currentUser.cgpa || 'N/A'}</div>
                            <div><strong>Skills:</strong> ${currentUser.skills ? currentUser.skills.join(', ') : 'N/A'}</div>
                            <div><strong>Interests:</strong> ${currentUser.interests ? currentUser.interests.join(', ') : 'N/A'}</div>
                            <div><strong>Approved Activities:</strong> ${approvedActivities.length}</div>
                        </div>
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-primary" id="generatePortfolioBtn">Generate Portfolio</button>
                        </div>
                    </div>
                `;
            } else { // Faculty
                const totalStudents = mockUsers.students.filter(s => s.branch === currentUser.department).length;
                const totalApproved = activities.filter(a => a.facultyId === currentUser.id && a.status === 'approved').length;
                
                profileContent.innerHTML = `
                    <div class="profile-card">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="profile-avatar">👨‍🏫</div>
                            <h3>${currentUser.name}</h3>
                            <p style="color: #6b7280;">${currentUser.designation}</p>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Faculty ID:</strong> ${currentUser.id}</div>
                            <div><strong>Email:</strong> ${currentUser.email}</div>
                            <div><strong>Department:</strong> ${currentUser.department}</div>
                            <div><strong>Total Students Supervised:</strong> ${totalStudents}</div>
                            <div><strong>Total Activities Approved:</strong> ${totalApproved}</div>
                        </div>
                    </div>
                `;
            }
        }

        function loadDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            const dashboardTitle = document.getElementById('dashboardTitle');
            
            if (userType === 'faculty') {
                dashboardTitle.textContent = 'Faculty Dashboard';
                loadFacultyDashboard();
            } else {
                dashboardTitle.textContent = 'Student Dashboard';
                loadStudentDashboard();
            }
        }
        
        function loadStudentDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            const studentActivities = activities.filter(a => a.studentId === currentUser.id);
            const approvedActivities = studentActivities.filter(a => a.status === 'approved');
            
            const myDepartmentFaculty = facultyList.filter(f => f.department === currentUser.branch);

            const facultyListHTML = myDepartmentFaculty.map(faculty => `
                <div class="list-item">
                    <strong>${faculty.name}</strong> (${faculty.id})
                    <br><small>${faculty.designation}, ${faculty.department}</small>
                </div>
            `).join('');
            
            const dashboardHTML = `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">📊</div>
                            <div class="card-title">Academic Performance</div>
                        </div>
                        <div class="card-value">${currentUser.cgpa || 'N/A'}</div>
                        <div class="card-description">Current CGPA</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">✅</div>
                            <div class="card-title">Attendance</div>
                        </div>
                        <div class="card-value">${currentUser.attendance || 0}%</div>
                        <div class="card-description">Overall attendance rate</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">🏆</div>
                            <div class="card-title">Approved Activities</div>
                        </div>
                        <div class="card-value">${approvedActivities.length}</div>
                        <div class="card-description">Total approved activities</div>
                    </div>
                </div>
                
                <div class="list-container">
                    <h3>Faculty in Your Department (${currentUser.branch})</h3>
                    <div class="list-group">
                        ${facultyListHTML.length > 0 ? facultyListHTML : '<p>No faculty found in your department.</p>'}
                    </div>
                </div>
            `;
            
            dashboardContent.innerHTML = dashboardHTML;
        }
        
        function loadFacultyDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            const pendingApprovalsCount = activities.filter(a => a.facultyId === currentUser.id && a.status === 'pending').length;
            const totalApproved = activities.filter(a => a.facultyId === currentUser.id && a.status === 'approved').length;
            const myDepartmentStudents = mockUsers.students.filter(s => s.branch === currentUser.department);

            const studentListHTML = myDepartmentStudents.map(student => `
                <div class="list-item">
                    <strong>${student.name}</strong> (${student.id})
                    <br><small>Year: ${student.year}, CGPA: ${student.cgpa || 'N/A'}</small>
                </div>
            `).join('');
            
            const dashboardHTML = `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">⏳</div>
                            <div class="card-title">Pending Approvals</div>
                        </div>
                        <div class="card-value">${pendingApprovalsCount}</div>
                        <div class="card-description">Activities awaiting approval</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">✅</div>
                            <div class="card-title">Total Approved</div>
                        </div>
                        <div class="card-value">${totalApproved}</div>
                        <div class="card-description">Activities approved so far</div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon">👥</div>
                            <div class="card-title">Students in Department</div>
                        </div>
                        <div class="card-value">${myDepartmentStudents.length}</div>
                        <div class="card-description">Total students in your department</div>
                    </div>
                </div>
                
                <div class="list-container">
                    <h3>Students in Your Department (${currentUser.department})</h3>
                    <div class="list-group">
                        ${studentListHTML.length > 0 ? studentListHTML : '<p>No students found in your department.</p>'}
                    </div>
                </div>
            `;
            
            dashboardContent.innerHTML = dashboardHTML;
        }

        function generatePortfolio() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text(`Student Portfolio - ${currentUser.name}`, 20, 20);
            doc.text(`Student ID: ${currentUser.id}`, 20, 30);
            doc.text(`Branch: ${currentUser.branch}`, 20, 40);
            doc.text(`Email: ${currentUser.email}`, 20, 50);
            doc.text(`CGPA: ${currentUser.cgpa || 'N/A'}`, 20, 60);
            doc.text(`Approved Activities`, 20, 80);

            const approvedActivities = activities.filter(a => a.studentId === currentUser.id && a.status === 'approved');
            let y = 90;

            if (approvedActivities.length > 0) {
                approvedActivities.forEach((activity, index) => {
                    doc.text(`${index + 1}. ${activity.name} (${activity.type})`, 25, y);
                    doc.text(`- Description: ${activity.description}`, 30, y + 5);
                    doc.text(`- Approved by: ${facultyList.find(f => f.id === activity.facultyId)?.name}`, 30, y + 10);
                    y += 20;
                });
            } else {
                doc.text('No approved activities yet.', 25, y);
            }

            doc.save(`${currentUser.name}_Portfolio.pdf`);
            showNotification('Portfolio generated and downloaded successfully!', 'success');
        }


        // Activity Management Functions
        function loadActivities() {
            if (userType === 'student') {
                loadStudentActivities();
                document.getElementById('studentActivityForm').classList.remove('hidden');
                document.getElementById('facultyApprovalPanel').classList.add('hidden');
            } else {
                loadFacultyApprovals();
                document.getElementById('studentActivityForm').classList.add('hidden');
                document.getElementById('facultyApprovalPanel').classList.remove('hidden');
            }
        }

        function loadStudentActivities() {
            const studentActivities = activities.filter(a => a.studentId === currentUser.id);
            const pendingList = document.getElementById('pendingApprovalsList');
            
            if (studentActivities.length === 0) {
                pendingList.innerHTML = '<p>No activities submitted yet.</p>';
                return;
            }
            
            const activitiesHTML = studentActivities.map(activity => {
                const faculty = facultyList.find(f => f.id === activity.facultyId);
                const statusClass = activity.status === 'approved' ? 'approved' : 
                                   activity.status === 'rejected' ? 'rejected' : '';
                
                return `
                    <div class="approval-item ${statusClass}">
                        <div>
                            <strong>${activity.name}</strong>
                            <p>Supervisor: ${faculty ? faculty.name : 'Unknown'}</p>
                            <p>Status: ${activity.status.toUpperCase()}</p>
                            <small>Submitted: ${new Date(activity.submittedAt).toLocaleDateString()}</small>
                            ${activity.approvedAt ? `<small> | Approved: ${new Date(activity.approvedAt).toLocaleDateString()}</small>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            pendingList.innerHTML = activitiesHTML;
        }

        function loadFacultyApprovals() {
            const pendingApprovals = activities.filter(a => a.facultyId === currentUser.id && a.status === 'pending');
            const approvalQueue = document.getElementById('approvalQueue');
            
            if (pendingApprovals.length === 0) {
                approvalQueue.innerHTML = '<p>No activities pending approval.</p>';
                return;
            }
            
            const approvalsHTML = pendingApprovals.map(activity => {
                const student = mockUsers.students.find(s => s.id === activity.studentId);
                
                return `
                    <div class="approval-item">
                        <div>
                            <strong>${activity.name}</strong>
                            <p>Student: ${student ? student.name : 'Unknown'} (${activity.studentId})</p>
                            <p>Type: ${activity.type}</p>
                            <p>Description: ${activity.description}</p>
                            <small>Submitted: ${new Date(activity.submittedAt).toLocaleDateString()}</small>
                        </div>
                        <div class="approval-actions">
                            <button class="btn-small btn-approve" onclick="approveActivity('${activity.id}')">Approve</button>
                            <button class="btn-small btn-reject" onclick="rejectActivity('${activity.id}')">Reject</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            approvalQueue.innerHTML = approvalsHTML;
        }

        function handleActivitySubmission(e) {
            e.preventDefault();
            
            const newActivity = {
                id: `ACT${String(activities.length + 1).padStart(3, '0')}`,
                studentId: currentUser.id,
                type: document.getElementById('activityType').value,
                name: document.getElementById('activityName').value,
                description: document.getElementById('activityDescription').value,
                facultyId: document.getElementById('selectedFacultyId').value,
                status: 'pending',
                submittedAt: new Date(),
                file: document.getElementById('activityFile').files[0]?.name || ''
            };
            
            activities.push(newActivity);
            
            document.getElementById('activitySubmissionForm').reset();
            document.getElementById('facultySearch').value = '';
            document.getElementById('selectedFacultyId').value = '';
            
            loadStudentActivities();
            showNotification('Activity submitted successfully!', 'success');
            
            setTimeout(() => {
                if (wsConnection) {
                    wsConnection.send(JSON.stringify({
                        type: 'new_activity',
                        activityId: newActivity.id,
                        facultyId: newActivity.facultyId
                    }));
                }
            }, 1000);
        }

        function handleFacultySearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const dropdown = document.getElementById('facultyDropdown');
            const myDepartmentFaculty = facultyList.filter(f => f.department === currentUser.branch);
            
            if (searchTerm.length < 2) {
                dropdown.style.display = 'none';
                return;
            }
            
            const matchedFaculty = myDepartmentFaculty.filter(faculty => 
                faculty.name.toLowerCase().includes(searchTerm) ||
                faculty.id.toLowerCase().includes(searchTerm) ||
                faculty.department.toLowerCase().includes(searchTerm)
            );
            
            if (matchedFaculty.length > 0) {
                const optionsHTML = matchedFaculty.map(faculty => 
                    `<div class="faculty-option" onclick="selectFaculty('${faculty.id}', '${faculty.name}')">
                        <strong>${faculty.name}</strong> (${faculty.id})
                        <br><small>${faculty.department}</small>
                    </div>`
                ).join('');
                
                dropdown.innerHTML = optionsHTML;
                dropdown.style.display = 'block';
            } else {
                dropdown.style.style.display = 'none';
                dropdown.innerHTML = `<div style="padding: 1rem;">No faculty found.</div>`;
            }
        }

        function selectFaculty(facultyId, facultyName) {
            document.getElementById('facultySearch').value = facultyName;
            document.getElementById('selectedFacultyId').value = facultyId;
            document.getElementById('facultyDropdown').style.display = 'none';
        }

        function approveActivity(activityId) {
            const activity = activities.find(a => a.id === activityId);
            if (activity) {
                activity.status = 'approved';
                activity.approvedAt = new Date();
                
                loadFacultyApprovals();
                showNotification('Activity approved successfully!', 'success');
                
                if (wsConnection) {
                    wsConnection.send(JSON.stringify({
                        type: 'activity_approved',
                        activityId,
                        studentId: activity.studentId
                    }));
                }
            }
        }

        function rejectActivity(activityId) {
            const activity = activities.find(a => a.id === activityId);
            if (activity) {
                activity.status = 'rejected';
                activity.rejectedAt = new Date();
                
                loadFacultyApprovals();
                showNotification('Activity rejected!', 'error');
                
                if (wsConnection) {
                    wsConnection.send(JSON.stringify({
                        type: 'activity_rejected',
                        activityId,
                        studentId: activity.studentId
                    }));
                }
            }
        }

        // Real-time Updates
        function setupRealTimeUpdates() {
            wsConnection = {
                send: (data) => {
                    console.log('WebSocket message sent:', data);
                    setTimeout(() => {
                        const message = JSON.parse(data);
                        handleRealTimeUpdate(message);
                    }, 500);
                }
            };
            
            setInterval(() => {
                updateLiveIndicators();
                refreshRecommendations();
            }, 30000);
        }

        function handleRealTimeUpdate(message) {
            switch (message.type) {
                case 'new_activity':
                    if (userType === 'faculty' && currentUser.id === message.facultyId) {
                        showNotification('New activity submitted for your approval!', 'info');
                        loadFacultyApprovals();
                    }
                    break;
                case 'activity_approved':
                    if (userType === 'student' && currentUser.id === message.studentId) {
                        showNotification('Your activity has been approved!', 'success');
                        loadStudentActivities();
                        loadDashboard();
                    }
                    break;
                case 'activity_rejected':
                    if (userType === 'student' && currentUser.id === message.studentId) {
                        showNotification('Your activity was rejected. Please check with your supervisor.', 'error');
                        loadStudentActivities();
                    }
                    break;
            }
        }

        function updateLiveIndicators() {
            const indicators = document.querySelectorAll('.live-indicator');
            indicators.forEach(indicator => {
                indicator.style.animationDuration = Math.random() * 2 + 1 + 's';
            });
        }

        // Recommendations System (Only for Students)
        function loadRecommendations() {
            if (userType === 'faculty') {
                return;
            }
            
            setTimeout(() => {
                loadInternshipRecommendations();
            }, 1000);
            
            setTimeout(() => {
                loadScholarshipRecommendations();
            }, 1500);
            
            setTimeout(() => {
                loadJobRecommendations();
            }, 2000);
            
            setTimeout(() => {
                loadEventRecommendations();
            }, 2500);
        }

        function loadInternshipRecommendations() {
            const recommendations = [
                { title: "Software Development Intern", company: "TechCorp", match: "95%", location: "Bangalore" },
                { title: "Data Science Intern", company: "DataTech", match: "88%", location: "Hyderabad" },
                { title: "ML Engineering Intern", company: "AI Solutions", match: "92%", location: "Pune" },
                { title: "Full Stack Developer Intern", company: "WebTech", match: "90%", location: "Chennai" }
            ];
            const container = document.getElementById('internship-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.company} - ${item.location}</p>
                    <small>Match: ${item.match}</small>
                </div>
            `).join('');
        }

        function loadScholarshipRecommendations() {
            const recommendations = [
                { title: "Merit Scholarship for CS Students", provider: "Tech Foundation", amount: "₹50,000" },
                { title: "Innovation Excellence Award", provider: "Government of India", amount: "₹75,000" },
                { title: "Women in Tech Scholarship", provider: "WiT Foundation", amount: "₹1,00,000" },
                { title: "Open Source Contributor Grant", provider: "OSS India", amount: "₹25,000" }
            ];
            const container = document.getElementById('scholarship-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.provider}</p>
                    <small>Amount: ${item.amount}</small>
                </div>
            `).join('');
        }

        function loadJobRecommendations() {
            const recommendations = [
                { title: "Junior Software Engineer", company: "Infosys", salary: "₹4.5 LPA", experience: "0-1 years" },
                { title: "Python Developer", company: "Wipro", salary: "₹5.2 LPA", experience: "0-2 years" },
                { title: "Data Analyst", company: "TCS", salary: "₹4.8 LPA", experience: "0-1 years" },
                { title: "Frontend Developer", company: "Accenture", salary: "₹5.0 LPA", experience: "0-2 years" }
            ];
            const container = document.getElementById('job-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.company}</p>
                    <small>Salary: ${item.salary} | Experience: ${item.experience}</small>
                </div>
            `).join('');
        }

        function loadEventRecommendations() {
            const recommendations = [
                { title: "AI/ML Workshop", date: "Oct 15, 2025", organizer: "IEEE Student Chapter", type: "Workshop" },
                { title: "Hackathon 2025", date: "Nov 20, 2025", organizer: "CodeChef", type: "Competition" },
                { title: "Tech Conference", date: "Dec 5, 2025", organizer: "Google Developers", type: "Conference" },
                { title: "Career Fair", date: "Jan 10, 2026", organizer: "University", type: "Fair" }
            ];
            const container = document.getElementById('event-recommendations');
            container.innerHTML = recommendations.map(item => `
                <div class="recommendation-item">
                    <strong>${item.title}</strong>
                    <p>${item.organizer}</p>
                    <small>Date: ${item.date} | Type: ${item.type}</small>
                </div>
            `).join('');
        }

        function refreshRecommendations() {
            if (currentUser && userType === 'student') {
                loadRecommendations();
            }
        }

        // Chatbot Functions
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.style.display = chatWindow.style.display === 'flex' ? 'none' : 'flex';
            
            if (chatWindow.style.display === 'flex') {
                if (currentUser && !chatWindow.dataset.initialized) {
                    addMessage(`Hello ${currentUser.name}! I'm here to help you with your academic journey. What would you like to know?`, 'bot');
                    chatWindow.dataset.initialized = 'true';
                }
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot typing';
            typingDiv.innerHTML = 'Assistant is typing...';
            document.getElementById('chatMessages').appendChild(typingDiv);

            getAIResponse(message).then(response => {
                document.getElementById('chatMessages').removeChild(typingDiv);
                addMessage(response, 'bot');
            });
        }

        async function getAIResponse(message) {
            const prompt = `You are a helpful assistant for the Smart Student Hub platform.
                            Current user data:
                            Name: ${currentUser?.name || 'Guest'}
                            User Type: ${userType || 'unknown'}
                            Branch/Department: ${currentUser?.branch || currentUser?.department || 'N/A'}
                            Activities: ${JSON.stringify(activities.filter(a => a.studentId === currentUser?.id))}
                            
                            Based on this context, provide a helpful and professional response to the following query:
                            ${message}`;
            try {
                const response = await fetch(geminiApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                const data = await response.json();
                if (data.candidates && data.candidates.length > 0) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    return 'Sorry, I could not generate a response. Please try again.';
                }
            } catch (error) {
                console.error('Gemini API Error:', error);
                return 'Sorry, I encountered an error. Please try again.';
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'info' ? '#3b82f6' : '#f59e0b'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                z-index: 1003;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
    </script>
</body>
</html>